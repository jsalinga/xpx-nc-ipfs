{"version":3,"sources":["webpack:///editor.js","webpack:///webpack/bootstrap f5665c16fccc70fd4dbe","webpack:///./js/PasteImage.ts","webpack:///./js/PreviewPlugin.ts","webpack:///./js/PublicPreview.ts","webpack:///./js/SidebarPreview.ts","webpack:///./js/editor.ts"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","i","l","call","parentJsonpFunction","window","chunkIds","moreModules","executeModules","chunkId","resolves","length","installedChunks","push","Object","prototype","hasOwnProperty","shift","4","e","onScriptComplete","script","onerror","onload","clearTimeout","timeout","chunk","Error","undefined","installedChunkData","Promise","resolve","promise","reject","head","document","getElementsByTagName","createElement","type","charset","async","nc","setAttribute","src","p","setTimeout","appendChild","m","c","d","name","getter","o","defineProperty","configurable","enumerable","get","n","__esModule","object","property","oe","err","console","error","s","./js/PasteImage.ts","__webpack_exports__","PasteImage","this","initialized","listeners","listenForPaste","_this","addEventListener","pasteHandler","init","clipboardData","items","includes","blob","getAsFile","URLObj","getURLObj","source","createObjectURL","createImage","URL","file","pastedImage","Image","_i","_a","listener","listen","handler","./js/PreviewPlugin.ts","PreviewPlugin","__WEBPACK_IMPORTED_MODULE_0__PasteImage__","scrollOffsetLines","initPromise","offsetMap","scrollMode","preview","_","throttle","text","element","initAceHooks","initPreviewHooks","onpopstate","onHashChange","then","renderer","renderText","buildOffsetMap","previewOffset","offset","top","find","each","parseInt","dataset","line","$","onScrollEditor","Math","max","floor","index","scrollTop","resetScrollMode","onScrollPreview","previewElement","previewLine","findIndex","session","getLength","aceEditor","scrollToLine","debounce","handleImage","image","OC","dialogs","prompt","ok","cursorPos","getCursorPosition","uploadText","finalText","insert","uploadImage","replace","rangeConstructor","row","column","bind","Renderer","textEditorOnHashChange","aceRequire","acequire","require","Range","getSession","$blockScrolling","Infinity","on","scroll","initCheckboxHandler","location","hash","substr","checked","oldText","getLine","indexOf","doc","path","getCurrentPath","url","linkToRemote","reader","FileReader","deferred","Deferred","onloadend","ajax","processData","data","result","success","readAsArrayBuffer","OCA","Files_Texteditor","dir","Files","App","fileList","_currentDirectory","./js/PublicPreview.ts","PublicPreview","deferred_1","catch","attach","shareToken","addClass","children","remove","when","getFileContent","content","removeClass","generateUrl","token","./js/SidebarPreview.ts","SidebarPreview","handlePreview","model","$thumbnailDiv","$thumbnailContainer","fallback","previewWidth","parent","width","previewHeight","getFullPath","$textPreview","append","css","manager","addPreviewHandler","linkToRemoteBase","./js/editor.ts","value","__WEBPACK_IMPORTED_MODULE_0__PreviewPlugin__","__WEBPACK_IMPORTED_MODULE_1__SidebarPreview__","__WEBPACK_IMPORTED_MODULE_2__PublicPreview__","previewPlugin","ready","registerPreviewPlugin","val","publicPreview","previewRoot","previewFrame","prepend","filePath","querySelector","getAttribute","Plugins","register"],"mappings":"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","file":"editor.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// install a JSONP callback for chunk loading\n/******/ \tvar parentJsonpFunction = window[\"webpackJsonpMarkdown\"];\n/******/ \twindow[\"webpackJsonpMarkdown\"] = function webpackJsonpCallback(chunkIds, moreModules, executeModules) {\n/******/ \t\t// add \"moreModules\" to the modules object,\n/******/ \t\t// then flag all \"chunkIds\" as loaded and fire callback\n/******/ \t\tvar moduleId, chunkId, i = 0, resolves = [], result;\n/******/ \t\tfor(;i < chunkIds.length; i++) {\n/******/ \t\t\tchunkId = chunkIds[i];\n/******/ \t\t\tif(installedChunks[chunkId]) {\n/******/ \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n/******/ \t\t\t}\n/******/ \t\t\tinstalledChunks[chunkId] = 0;\n/******/ \t\t}\n/******/ \t\tfor(moduleId in moreModules) {\n/******/ \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n/******/ \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n/******/ \t\t\t}\n/******/ \t\t}\n/******/ \t\tif(parentJsonpFunction) parentJsonpFunction(chunkIds, moreModules, executeModules);\n/******/ \t\twhile(resolves.length) {\n/******/ \t\t\tresolves.shift()();\n/******/ \t\t}\n/******/\n/******/ \t};\n/******/\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// objects to store loaded and loading chunks\n/******/ \tvar installedChunks = {\n/******/ \t\t4: 0\n/******/ \t};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/ \t// This file contains only the entry chunk.\n/******/ \t// The chunk loading function for additional chunks\n/******/ \t__webpack_require__.e = function requireEnsure(chunkId) {\n/******/ \t\tvar installedChunkData = installedChunks[chunkId];\n/******/ \t\tif(installedChunkData === 0) {\n/******/ \t\t\treturn new Promise(function(resolve) { resolve(); });\n/******/ \t\t}\n/******/\n/******/ \t\t// a Promise means \"currently loading\".\n/******/ \t\tif(installedChunkData) {\n/******/ \t\t\treturn installedChunkData[2];\n/******/ \t\t}\n/******/\n/******/ \t\t// setup Promise in chunk cache\n/******/ \t\tvar promise = new Promise(function(resolve, reject) {\n/******/ \t\t\tinstalledChunkData = installedChunks[chunkId] = [resolve, reject];\n/******/ \t\t});\n/******/ \t\tinstalledChunkData[2] = promise;\n/******/\n/******/ \t\t// start chunk loading\n/******/ \t\tvar head = document.getElementsByTagName('head')[0];\n/******/ \t\tvar script = document.createElement('script');\n/******/ \t\tscript.type = 'text/javascript';\n/******/ \t\tscript.charset = 'utf-8';\n/******/ \t\tscript.async = true;\n/******/ \t\tscript.timeout = 120000;\n/******/\n/******/ \t\tif (__webpack_require__.nc) {\n/******/ \t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n/******/ \t\t}\n/******/ \t\tscript.src = __webpack_require__.p + \"\" + chunkId + \".editor.js\";\n/******/ \t\tvar timeout = setTimeout(onScriptComplete, 120000);\n/******/ \t\tscript.onerror = script.onload = onScriptComplete;\n/******/ \t\tfunction onScriptComplete() {\n/******/ \t\t\t// avoid mem leaks in IE.\n/******/ \t\t\tscript.onerror = script.onload = null;\n/******/ \t\t\tclearTimeout(timeout);\n/******/ \t\t\tvar chunk = installedChunks[chunkId];\n/******/ \t\t\tif(chunk !== 0) {\n/******/ \t\t\t\tif(chunk) {\n/******/ \t\t\t\t\tchunk[1](new Error('Loading chunk ' + chunkId + ' failed.'));\n/******/ \t\t\t\t}\n/******/ \t\t\t\tinstalledChunks[chunkId] = undefined;\n/******/ \t\t\t}\n/******/ \t\t};\n/******/ \t\thead.appendChild(script);\n/******/\n/******/ \t\treturn promise;\n/******/ \t};\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// on error function for async loading\n/******/ \t__webpack_require__.oe = function(err) { console.error(err); throw err; };\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = \"./js/editor.ts\");\n/******/ })\n/************************************************************************/\n/******/ ({\n\n/***/ \"./js/PasteImage.ts\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return PasteImage; });\n// from https://github.com/redgeoff/paste-image\nvar PasteImage = (function () {\n    function PasteImage() {\n        this.initialized = false;\n        this.listeners = [];\n    }\n    PasteImage.prototype.listenForPaste = function () {\n        var _this = this;\n        window.addEventListener('paste', function (e) {\n            _this.pasteHandler(e);\n        });\n    };\n    PasteImage.prototype.init = function () {\n        if (this.initialized) {\n            return;\n        }\n        this.listenForPaste();\n        this.initialized = true;\n    };\n    PasteImage.prototype.pasteHandler = function (e) {\n        if (e.clipboardData && e.clipboardData.items) {\n            // Get the items from the clipboard\n            var items = e.clipboardData.items;\n            // Loop through all items, looking for any kind of image\n            for (var i = 0; i < items.length; i++) {\n                if (items[i].type.includes('image')) {\n                    var blob = items[i].getAsFile();\n                    var URLObj = this.getURLObj();\n                    var source = URLObj.createObjectURL(blob);\n                    // The URL can then be used as the source of an image\n                    this.createImage(source, blob);\n                }\n            }\n        }\n    };\n    PasteImage.prototype.getURLObj = function () {\n        return window.URL || window['webkitURL'];\n    };\n    // Creates a new image from a given source\n    PasteImage.prototype.createImage = function (source, file) {\n        var _this = this;\n        var pastedImage = new Image();\n        pastedImage.onload = function () {\n            for (var _i = 0, _a = _this.listeners; _i < _a.length; _i++) {\n                var listener = _a[_i];\n                listener(pastedImage, file);\n            }\n        };\n        pastedImage.src = source;\n    };\n    PasteImage.prototype.listen = function (handler) {\n        this.init();\n        this.listeners.push(handler);\n    };\n    return PasteImage;\n}());\n\n\n\n/***/ }),\n\n/***/ \"./js/PreviewPlugin.ts\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return PreviewPlugin; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__PasteImage__ = __webpack_require__(\"./js/PasteImage.ts\");\n\nvar scrollOffsetLines = 3;\nvar PreviewPlugin = (function () {\n    function PreviewPlugin() {\n        var _this = this;\n        this.initPromise = null;\n        this.offsetMap = [];\n        this.scrollMode = null;\n        this.preview = _.throttle(function (text, element) {\n            _this.initAceHooks();\n            _this.initPreviewHooks(element);\n            window.onpopstate = _this.onHashChange;\n            _this.init().then(function () {\n                _this.renderer.renderText(text, element).then(function () {\n                    setTimeout(function () {\n                        _this.buildOffsetMap(element);\n                    }, 500);\n                });\n            });\n        }, 500);\n        this.buildOffsetMap = _.throttle(function (element) {\n            var previewOffset = element.offset().top;\n            var offsetMap = [];\n            element.find('[data-line]').each(function () {\n                offsetMap[parseInt(this.dataset.line, 10)] = $(this).offset().top - previewOffset;\n            });\n            _this.offsetMap = offsetMap;\n        }, 1000);\n        this.onScrollEditor = _.throttle(function (top) {\n            if (_this.scrollMode === 'preview') {\n                return;\n            }\n            _this.scrollMode = 'editor';\n            var line = Math.max(0, Math.floor(top / 15) - scrollOffsetLines);\n            var previewOffset = _this.offsetMap.find(function (offset, index) { return (typeof offset !== 'undefined') && index >= line; });\n            if (typeof previewOffset !== 'undefined') {\n                $('#preview').scrollTop(previewOffset);\n            }\n            _this.resetScrollMode();\n        }, 100);\n        this.onScrollPreview = _.throttle(function () {\n            if (_this.scrollMode === 'editor') {\n                return;\n            }\n            _this.scrollMode = 'preview';\n            var top = _this.previewElement.scrollTop();\n            var previewLine = _this.offsetMap.findIndex(function (offset) { return offset >= (top - 1); });\n            if (previewLine < _this.session.getLength()) {\n                aceEditor.scrollToLine(Math.max(previewLine - scrollOffsetLines, 0), false, true, function () {\n                });\n            }\n            _this.resetScrollMode();\n        }, 100);\n        this.resetScrollMode = _.debounce(function () {\n            _this.scrollMode = null;\n        }, 500);\n        this.handleImage = function (image, file) {\n            OC.dialogs.prompt('Enter the name for the image', 'Upload image', function (ok, name) {\n                if (!ok) {\n                    return;\n                }\n                var blob = image.src;\n                var cursorPos = aceEditor.getCursorPosition();\n                var uploadText = \"![uploading...](\" + blob + \")\";\n                var finalText = \"![\" + name + \"](\" + name + \")\";\n                _this.session.insert(cursorPos, uploadText);\n                _this.uploadImage(name, file).then(function () {\n                    _this.session.replace(new _this.rangeConstructor(cursorPos.row, cursorPos.column, cursorPos.row, cursorPos.column + uploadText.length), finalText);\n                });\n            }, true, 'image name');\n        };\n    }\n    PreviewPlugin.prototype.init = function () {\n        var _this = this;\n        if (!this.initPromise) {\n            this.initPromise = __webpack_require__.e/* import() */(0/* duplicate */).then(__webpack_require__.bind(null, \"./js/Renderer.ts\")).then(function (_a) {\n                var Renderer = _a.Renderer;\n                _this.renderer = new Renderer();\n            }, console.error.bind(console));\n            if (!this.textEditorOnHashChange) {\n                this.textEditorOnHashChange = window.onpopstate;\n            }\n            var aceRequire = window['ace'].acequire || window['ace'].require;\n            this.rangeConstructor = aceRequire(\"ace/range\").Range;\n            new __WEBPACK_IMPORTED_MODULE_0__PasteImage__[\"a\" /* PasteImage */]().listen(this.handleImage);\n        }\n        return this.initPromise;\n    };\n    PreviewPlugin.prototype.initAceHooks = function () {\n        if (this.session !== aceEditor.getSession()) {\n            this.session = aceEditor.getSession();\n            aceEditor.$blockScrolling = Infinity;\n            this.session.on(\"changeScrollTop\", this.onScrollEditor);\n        }\n    };\n    PreviewPlugin.prototype.initPreviewHooks = function (element) {\n        if (this.previewElement !== element) {\n            this.previewElement = element;\n            this.previewElement.scroll(this.onScrollPreview);\n            this.initCheckboxHandler(element);\n        }\n    };\n    PreviewPlugin.prototype.onHashChange = function (e) {\n        var hash = window.location.hash.substr(1);\n        if (hash.substr(0, 6) !== 'editor' && this.textEditorOnHashChange) {\n            this.textEditorOnHashChange.call(window, e);\n        }\n    };\n    PreviewPlugin.prototype.initCheckboxHandler = function (element) {\n        var Range = this.rangeConstructor;\n        var session = this.session;\n        element.on('change', 'input[type=checkbox]', function () {\n            var checked = this.checked;\n            var row = this.dataset.line;\n            var oldText = session.getLine(row);\n            var index = oldText.indexOf('[') + 1;\n            session.replace(new Range(row, index, row, index + 1), checked ? 'x' : ' ');\n            session['$wrapData'].length = session.doc.getLength();\n        });\n    };\n    PreviewPlugin.prototype.uploadImage = function (name, file) {\n        var path = (this.getCurrentPath() + \"/\" + name).replace(/\\/\\/+/g, '/');\n        var url = OC.linkToRemote('files' + path);\n        var reader = new FileReader();\n        var deferred = $.Deferred();\n        reader.onloadend = function (e) {\n            $.ajax({\n                url: url,\n                processData: false,\n                data: reader.result,\n                type: 'PUT',\n                success: deferred.resolve.bind(deferred),\n                error: deferred.reject.bind(deferred)\n            });\n        };\n        reader.readAsArrayBuffer(file);\n        return deferred.promise();\n    };\n    PreviewPlugin.prototype.getCurrentPath = function () {\n        if (OCA.Files_Texteditor.file && OCA.Files_Texteditor.file.dir) {\n            return OCA.Files_Texteditor.file.dir;\n        }\n        else if (OCA.Files.App && OCA.Files.App.fileList._currentDirectory) {\n            return OCA.Files.App.fileList._currentDirectory;\n        }\n    };\n    return PreviewPlugin;\n}());\n\n\n\n/***/ }),\n\n/***/ \"./js/PublicPreview.ts\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return PublicPreview; });\nvar PublicPreview = (function () {\n    function PublicPreview() {\n        this.initPromise = null;\n    }\n    PublicPreview.prototype.init = function () {\n        var _this = this;\n        if (!this.initPromise) {\n            var deferred_1 = $.Deferred();\n            __webpack_require__.e/* require.ensure */(0).then((function () {\n                var Renderer = __webpack_require__(\"./js/Renderer.ts\").Renderer;\n                _this.renderer = new Renderer(true);\n                deferred_1.resolve();\n            }).bind(null, __webpack_require__)).catch(__webpack_require__.oe);\n            this.initPromise = deferred_1.promise();\n        }\n        return this.initPromise;\n    };\n    PublicPreview.prototype.attach = function (previewElement, shareToken) {\n        var _this = this;\n        previewElement\n            .addClass('icon-loading')\n            .children().remove();\n        $.when(this.getFileContent(shareToken), this.init()).then(function (_a) {\n            var content = _a[0];\n            previewElement\n                .removeClass('icon-loading');\n            _this.renderer.renderText(content, previewElement);\n        });\n    };\n    PublicPreview.prototype.getFileContent = function (shareToken) {\n        var url = OC.generateUrl('/s/{token}/download', { token: shareToken });\n        return $.get(url);\n    };\n    return PublicPreview;\n}());\n\n\n\n/***/ }),\n\n/***/ \"./js/SidebarPreview.ts\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return SidebarPreview; });\nvar SidebarPreview = (function () {\n    function SidebarPreview() {\n        var _this = this;\n        this.initPromise = null;\n        this.handlePreview = function (model, $thumbnailDiv, $thumbnailContainer, fallback) {\n            var previewWidth = $thumbnailContainer.parent().width() + 50; // 50px for negative margins\n            var previewHeight = previewWidth / (16 / 9);\n            $.when(_this.getFileContent(model.getFullPath()), _this.init()).then(function (_a) {\n                var content = _a[0];\n                $thumbnailDiv.removeClass('icon-loading icon-32');\n                $thumbnailContainer.addClass('large');\n                $thumbnailContainer.addClass('text');\n                var $textPreview = $('<div id=\"preview\" class=\"text-markdown\"/>');\n                _this.renderer.renderText(content, $textPreview);\n                $thumbnailDiv.children('.stretcher').remove();\n                $thumbnailDiv.append($textPreview);\n                $thumbnailContainer.css(\"max-height\", previewHeight);\n            }, function () {\n                fallback();\n            });\n        };\n    }\n    SidebarPreview.prototype.init = function () {\n        var _this = this;\n        if (!this.initPromise) {\n            var deferred_1 = $.Deferred();\n            __webpack_require__.e/* require.ensure */(0/* duplicate */).then((function () {\n                var Renderer = __webpack_require__(\"./js/Renderer.ts\").Renderer;\n                _this.renderer = new Renderer();\n                deferred_1.resolve();\n            }).bind(null, __webpack_require__)).catch(__webpack_require__.oe);\n            this.initPromise = deferred_1.promise();\n        }\n        return this.initPromise;\n    };\n    SidebarPreview.prototype.attach = function (manager) {\n        manager.addPreviewHandler('text/markdown', this.handlePreview);\n    };\n    SidebarPreview.prototype.getFileContent = function (path) {\n        var url = OC.linkToRemoteBase('files' + path);\n        return $.get(url);\n    };\n    return SidebarPreview;\n}());\n\n\n\n/***/ }),\n\n/***/ \"./js/editor.ts\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(__webpack_exports__, \"__esModule\", { value: true });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__PreviewPlugin__ = __webpack_require__(\"./js/PreviewPlugin.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__SidebarPreview__ = __webpack_require__(\"./js/SidebarPreview.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__PublicPreview__ = __webpack_require__(\"./js/PublicPreview.ts\");\n\n\n\nvar previewPlugin = new __WEBPACK_IMPORTED_MODULE_0__PreviewPlugin__[\"a\" /* PreviewPlugin */]();\n$(document).ready(function () {\n    if (OCA.Files_Texteditor && OCA.Files_Texteditor.registerPreviewPlugin) {\n        OCA.Files_Texteditor.registerPreviewPlugin('text/markdown', previewPlugin);\n    }\n    else if (!OCA.Files_Texteditor) {\n        OCA.Files_Texteditor = {};\n    }\n    if ($('#isPublic').val() &&\n        $('#mimetype').val() === 'text/markdown') {\n        var publicPreview = new __WEBPACK_IMPORTED_MODULE_2__PublicPreview__[\"a\" /* PublicPreview */]();\n        var previewRoot = $('#preview');\n        previewRoot.addClass('text-markdown');\n        var previewFrame = $('<div class=\"public-preview\"/>');\n        previewRoot.prepend(previewFrame);\n        publicPreview.attach(previewFrame, $('#sharingToken').val());\n    }\n});\n// coerce webpack into loading scripts properly\n__webpack_require__.p = OC.filePath('files_markdown', 'js', '../build/');\nvar script = document.querySelector('[nonce]');\n__webpack_require__.nc = script['nonce'] || script.getAttribute('nonce');\nOC.Plugins.register('OCA.Files.SidebarPreviewManager', new __WEBPACK_IMPORTED_MODULE_1__SidebarPreview__[\"a\" /* SidebarPreview */]());\n\n\n/***/ })\n\n/******/ });\n\n\n// WEBPACK FOOTER //\n// editor.js"," \t// install a JSONP callback for chunk loading\n \tvar parentJsonpFunction = window[\"webpackJsonpMarkdown\"];\n \twindow[\"webpackJsonpMarkdown\"] = function webpackJsonpCallback(chunkIds, moreModules, executeModules) {\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [], result;\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(chunkIds, moreModules, executeModules);\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t};\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// objects to store loaded and loading chunks\n \tvar installedChunks = {\n \t\t4: 0\n \t};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n \t// This file contains only the entry chunk.\n \t// The chunk loading function for additional chunks\n \t__webpack_require__.e = function requireEnsure(chunkId) {\n \t\tvar installedChunkData = installedChunks[chunkId];\n \t\tif(installedChunkData === 0) {\n \t\t\treturn new Promise(function(resolve) { resolve(); });\n \t\t}\n\n \t\t// a Promise means \"currently loading\".\n \t\tif(installedChunkData) {\n \t\t\treturn installedChunkData[2];\n \t\t}\n\n \t\t// setup Promise in chunk cache\n \t\tvar promise = new Promise(function(resolve, reject) {\n \t\t\tinstalledChunkData = installedChunks[chunkId] = [resolve, reject];\n \t\t});\n \t\tinstalledChunkData[2] = promise;\n\n \t\t// start chunk loading\n \t\tvar head = document.getElementsByTagName('head')[0];\n \t\tvar script = document.createElement('script');\n \t\tscript.type = 'text/javascript';\n \t\tscript.charset = 'utf-8';\n \t\tscript.async = true;\n \t\tscript.timeout = 120000;\n\n \t\tif (__webpack_require__.nc) {\n \t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n \t\t}\n \t\tscript.src = __webpack_require__.p + \"\" + chunkId + \".editor.js\";\n \t\tvar timeout = setTimeout(onScriptComplete, 120000);\n \t\tscript.onerror = script.onload = onScriptComplete;\n \t\tfunction onScriptComplete() {\n \t\t\t// avoid mem leaks in IE.\n \t\t\tscript.onerror = script.onload = null;\n \t\t\tclearTimeout(timeout);\n \t\t\tvar chunk = installedChunks[chunkId];\n \t\t\tif(chunk !== 0) {\n \t\t\t\tif(chunk) {\n \t\t\t\t\tchunk[1](new Error('Loading chunk ' + chunkId + ' failed.'));\n \t\t\t\t}\n \t\t\t\tinstalledChunks[chunkId] = undefined;\n \t\t\t}\n \t\t};\n \t\thead.appendChild(script);\n\n \t\treturn promise;\n \t};\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// on error function for async loading\n \t__webpack_require__.oe = function(err) { console.error(err); throw err; };\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./js/editor.ts\");\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap f5665c16fccc70fd4dbe","// from https://github.com/redgeoff/paste-image\n\n// This code is heavily based on Joel Basada's great work at\n// http://joelb.me/blog/2011/code-snippet-accessing-clipboard-images-with-javascript/\n\nexport type PasteListener = (image: HTMLImageElement, file: File) => void;\n\nexport class PasteImage {\n    private initialized: boolean = false;\n    private listeners: PasteListener[] = [];\n\n    private listenForPaste() {\n        window.addEventListener('paste', e => {\n            this.pasteHandler(e);\n        });\n    }\n\n    private init() {\n        if (this.initialized) {\n            return;\n        }\n        this.listenForPaste();\n        this.initialized = true;\n    }\n\n    private pasteHandler(e) {\n        if (e.clipboardData && e.clipboardData.items) {\n            // Get the items from the clipboard\n            const items = e.clipboardData.items;\n\n            // Loop through all items, looking for any kind of image\n            for (let i = 0; i < items.length; i++) {\n                if (items[i].type.includes('image')) {\n                    const blob = items[i].getAsFile();\n\n                    const URLObj = this.getURLObj();\n                    const source = URLObj.createObjectURL(blob);\n\n                    // The URL can then be used as the source of an image\n                    this.createImage(source, blob);\n                }\n            }\n        }\n    }\n\n    private getURLObj() {\n        return window.URL || window['webkitURL'];\n    }\n\n    // Creates a new image from a given source\n    private createImage(source: string, file: File) {\n        const pastedImage = new Image();\n\n        pastedImage.onload = () => {\n            for (const listener of this.listeners) {\n                listener(pastedImage, file);\n            }\n        };\n        pastedImage.src = source;\n    }\n\n    public listen(handler: PasteListener) {\n        this.init();\n        this.listeners.push(handler);\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./js/PasteImage.ts","import {Renderer} from './Renderer';\nimport {UnderscoreStatic} from \"underscore\";\nimport {PasteImage} from './PasteImage';\nimport Thenable = JQuery.Thenable;\nimport TextEditorPreviewPlugin = OCA.Files_Texteditor.TextEditorPreviewPlugin;\n\ndeclare const _: UnderscoreStatic;\n\ndeclare const aceEditor: AceAjax.Editor;\n\ntype onPopstate = (this: Window, ev: PopStateEvent) => any;\n\nconst scrollOffsetLines = 3;\n\nexport class PreviewPlugin implements TextEditorPreviewPlugin {\n    private renderer: Renderer;\n    private rangeConstructor: new (startRow: number, startColumn: number, endRow: number, endColumn: number) => AceAjax.Range;\n\n    private initPromise: Promise<void> | null = null;\n    private textEditorOnHashChange: onPopstate | null;\n    private offsetMap: number[] = [];\n    private session: AceAjax.IEditSession;\n    private previewElement: JQuery;\n    private scrollMode: 'editor' | 'preview' | null = null;\n\n    init() {\n        if (!this.initPromise) {\n            this.initPromise = import('./Renderer').then(({Renderer}) => {\n                this.renderer = new Renderer();\n            }, console.error.bind(console));\n            if (!this.textEditorOnHashChange) {\n                this.textEditorOnHashChange = window.onpopstate;\n            }\n\n            const aceRequire = window['ace'].acequire || window['ace'].require;\n            this.rangeConstructor = aceRequire(\"ace/range\").Range;\n\n            new PasteImage().listen(this.handleImage);\n        }\n\n        return this.initPromise;\n    }\n\n    initAceHooks() {\n        if (this.session !== aceEditor.getSession()) {\n            this.session = aceEditor.getSession();\n            aceEditor.$blockScrolling = Infinity;\n            this.session.on(\"changeScrollTop\", this.onScrollEditor);\n        }\n    }\n\n    initPreviewHooks(element) {\n        if (this.previewElement !== element) {\n            this.previewElement = element;\n            this.previewElement.scroll(this.onScrollPreview);\n            this.initCheckboxHandler(element);\n        }\n    }\n\n    onHashChange(e: PopStateEvent) {\n        const hash = window.location.hash.substr(1);\n        if (hash.substr(0, 6) !== 'editor' && this.textEditorOnHashChange) {\n            this.textEditorOnHashChange.call(window, e)\n        }\n    }\n\n    preview = _.throttle((text: string, element) => {\n        this.initAceHooks();\n        this.initPreviewHooks(element);\n        window.onpopstate = this.onHashChange;\n\n        this.init().then(() => {\n            this.renderer.renderText(text, element).then(() => {\n                setTimeout(() => {\n                    this.buildOffsetMap(element)\n                }, 500);\n            });\n        });\n    }, 500);\n\n    initCheckboxHandler(element) {\n        const Range = this.rangeConstructor;\n        const session = this.session;\n        element.on('change', 'input[type=checkbox]', function () {\n            const checked = this.checked;\n            const row = this.dataset.line;\n            const oldText = session.getLine(row);\n            const index = oldText.indexOf('[') + 1;\n            session.replace(new Range(row, index, row, index + 1), checked ? 'x' : ' ');\n            session['$wrapData'].length = session.doc.getLength();\n        });\n    }\n\n    buildOffsetMap = _.throttle((element) => {\n        const previewOffset = (element.offset() as { top: number }).top;\n        const offsetMap: number[] = [];\n        element.find('[data-line]').each(function () {\n            offsetMap[parseInt(this.dataset.line, 10)] = ($(this).offset() as { top: number }).top - previewOffset;\n        });\n        this.offsetMap = offsetMap;\n    }, 1000);\n\n    onScrollEditor = _.throttle((top: number) => {\n        if (this.scrollMode === 'preview') {\n            return;\n        }\n        this.scrollMode = 'editor';\n        const line = Math.max(0, Math.floor(top / 15) - scrollOffsetLines);\n        const previewOffset = this.offsetMap.find((offset, index) => (typeof offset !== 'undefined') && index >= line);\n        if (typeof previewOffset !== 'undefined') {\n            $('#preview').scrollTop(previewOffset);\n        }\n        this.resetScrollMode();\n    }, 100);\n\n    onScrollPreview = _.throttle(() => {\n        if (this.scrollMode === 'editor') {\n            return;\n        }\n        this.scrollMode = 'preview';\n        const top = this.previewElement.scrollTop() as number;\n        const previewLine = this.offsetMap.findIndex(offset => offset >= (top - 1));\n        if (previewLine < this.session.getLength()) {\n            aceEditor.scrollToLine(Math.max(previewLine - scrollOffsetLines, 0), false, true, () => {\n            });\n        }\n        this.resetScrollMode();\n    }, 100);\n\n    resetScrollMode = _.debounce(() => {\n        this.scrollMode = null;\n    }, 500);\n\n    handleImage = (image: HTMLImageElement, file) => {\n        OC.dialogs.prompt('Enter the name for the image', 'Upload image', (ok, name) => {\n            if (!ok) {\n                return;\n            }\n            const blob = image.src;\n            const cursorPos = aceEditor.getCursorPosition();\n            const uploadText = `![uploading...](${blob})`;\n            const finalText = `![${name}](${name})`;\n            this.session.insert(cursorPos, uploadText);\n            this.uploadImage(name, file).then(() => {\n                this.session.replace(\n                    new this.rangeConstructor(cursorPos.row, cursorPos.column, cursorPos.row, cursorPos.column + uploadText.length),\n                    finalText\n                );\n            });\n\n        }, true, 'image name');\n    };\n\n    uploadImage(name: string, file: File): Thenable<void> {\n        const path = `${this.getCurrentPath()}/${name}`.replace(/\\/\\/+/g, '/');\n        const url = OC.linkToRemote('files' + path);\n        const reader = new FileReader();\n        const deferred = $.Deferred();\n        reader.onloadend = (e) => {\n            $.ajax({\n                url: url,\n                processData: false,\n                data: reader.result,\n                type: 'PUT',\n                success: deferred.resolve.bind(deferred),\n                error: deferred.reject.bind(deferred)\n            });\n        };\n        reader.readAsArrayBuffer(file);\n        return deferred.promise();\n    }\n\n    getCurrentPath() {\n        if (OCA.Files_Texteditor.file && OCA.Files_Texteditor.file.dir) {\n            return OCA.Files_Texteditor.file.dir;\n        } else if (OCA.Files.App && OCA.Files.App.fileList._currentDirectory) {\n            return OCA.Files.App.fileList._currentDirectory;\n        }\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./js/PreviewPlugin.ts","import {Renderer} from \"./Renderer\";\n\nexport class PublicPreview {\n    private renderer: Renderer;\n\n    private initPromise: JQueryPromise<void> | null = null;\n\n    init() {\n        if (!this.initPromise) {\n            const deferred = $.Deferred();\n            require.ensure(['./Renderer'], () => {\n                const {Renderer} = require('./Renderer');\n                this.renderer = new Renderer(true);\n                deferred.resolve();\n            });\n            this.initPromise = deferred.promise();\n        }\n        return this.initPromise;\n    }\n\n    attach(previewElement: JQuery, shareToken: string) {\n        previewElement\n            .addClass('icon-loading')\n            .children().remove();\n\n        $.when(\n            this.getFileContent(shareToken),\n            this.init()\n        ).then(([content]) => {\n            previewElement\n                .removeClass('icon-loading');\n\n            this.renderer.renderText(content, previewElement);\n        });\n    }\n\n    getFileContent(shareToken: string) {\n        const url = OC.generateUrl('/s/{token}/download', {token: shareToken});\n        return $.get(url);\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./js/PublicPreview.ts","import {Renderer} from \"./Renderer\";\n\nexport class SidebarPreview implements SidebarPreviewPlugin {\n    private renderer: Renderer;\n\n    private initPromise: JQueryPromise<void> | null = null;\n\n    init() {\n        if (!this.initPromise) {\n            const deferred = $.Deferred();\n            require.ensure(['./Renderer'], () => {\n                const {Renderer} = require('./Renderer');\n                this.renderer = new Renderer();\n                deferred.resolve();\n            });\n            this.initPromise = deferred.promise();\n        }\n        return this.initPromise;\n    }\n\n    attach(manager) {\n        manager.addPreviewHandler('text/markdown', this.handlePreview);\n    }\n\n    handlePreview: SidebarPreviewRender = (model, $thumbnailDiv, $thumbnailContainer, fallback) => {\n        const previewWidth = ($thumbnailContainer.parent().width() as number) + 50;  // 50px for negative margins\n        const previewHeight = previewWidth / (16 / 9);\n\n        $.when(\n            this.getFileContent(model.getFullPath()),\n            this.init()\n        ).then(([content]) => {\n            $thumbnailDiv.removeClass('icon-loading icon-32');\n            $thumbnailContainer.addClass('large');\n            $thumbnailContainer.addClass('text');\n            const $textPreview = $('<div id=\"preview\" class=\"text-markdown\"/>');\n            this.renderer.renderText(content, $textPreview);\n            $thumbnailDiv.children('.stretcher').remove();\n            $thumbnailDiv.append($textPreview);\n            $thumbnailContainer.css(\"max-height\", previewHeight);\n        }, function () {\n            fallback();\n        });\n    };\n\n    getFileContent(path: string) {\n        const url = OC.linkToRemoteBase('files' + path);\n        return $.get(url);\n    }\n}\n\n\n// WEBPACK FOOTER //\n// ./js/SidebarPreview.ts","import {PreviewPlugin} from \"./PreviewPlugin\";\nimport {SidebarPreview} from \"./SidebarPreview\";\nimport {PublicPreview} from \"./PublicPreview\";\n\nconst previewPlugin = new PreviewPlugin();\n\n$(document).ready(function () {\n    if (OCA.Files_Texteditor && OCA.Files_Texteditor.registerPreviewPlugin) {\n        OCA.Files_Texteditor.registerPreviewPlugin('text/markdown', previewPlugin);\n    } else if (!OCA.Files_Texteditor) {\n        OCA.Files_Texteditor = {};\n    }\n\n    if (\n        $('#isPublic').val() &&\n        $('#mimetype').val() === 'text/markdown'\n    ) {\n        const publicPreview = new PublicPreview();\n        const previewRoot = $('#preview');\n        previewRoot.addClass('text-markdown');\n        const previewFrame = $('<div class=\"public-preview\"/>');\n        previewRoot.prepend(previewFrame);\n        publicPreview.attach(previewFrame, $('#sharingToken').val());\n    }\n});\n\n// coerce webpack into loading scripts properly\n__webpack_require__.p = OC.filePath('files_markdown', 'js', '../build/');\nconst script = document.querySelector('[nonce]') as HTMLScriptElement;\n__webpack_require__.nc = script['nonce'] || script.getAttribute('nonce');\n\nOC.Plugins.register('OCA.Files.SidebarPreviewManager', new SidebarPreview());\n\n\n\n// WEBPACK FOOTER //\n// ./js/editor.ts"],"sourceRoot":""}