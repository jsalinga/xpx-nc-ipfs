!function(e){function t(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n=window.webpackJsonpMarkdown;window.webpackJsonpMarkdown=function(t,i,o){for(var s,a,c=0,l=[];c<t.length;c++)a=t[c],r[a]&&l.push(r[a][0]),r[a]=0;for(s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s]);for(n&&n(t,i,o);l.length;)l.shift()()};var i={},r={4:0};t.e=function(e){function n(){a.onerror=a.onload=null,clearTimeout(c);var t=r[e];0!==t&&(t&&t[1](new Error("Loading chunk "+e+" failed.")),r[e]=void 0)}var i=r[e];if(0===i)return new Promise(function(e){e()});if(i)return i[2];var o=new Promise(function(t,n){i=r[e]=[t,n]});i[2]=o;var s=document.getElementsByTagName("head")[0],a=document.createElement("script");a.type="text/javascript",a.charset="utf-8",a.async=!0,a.timeout=12e4,t.nc&&a.setAttribute("nonce",t.nc),a.src=t.p+""+e+".editor.js";var c=setTimeout(n,12e4);return a.onerror=a.onload=n,s.appendChild(a),o},t.m=e,t.c=i,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t.oe=function(e){throw console.error(e),e},t(t.s="./js/editor.ts")}({"./js/PasteImage.ts":function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i=function(){function e(){this.initialized=!1,this.listeners=[]}return e.prototype.listenForPaste=function(){var e=this;window.addEventListener("paste",function(t){e.pasteHandler(t)})},e.prototype.init=function(){this.initialized||(this.listenForPaste(),this.initialized=!0)},e.prototype.pasteHandler=function(e){if(e.clipboardData&&e.clipboardData.items)for(var t=e.clipboardData.items,n=0;n<t.length;n++)if(t[n].type.includes("image")){var i=t[n].getAsFile(),r=this.getURLObj(),o=r.createObjectURL(i);this.createImage(o,i)}},e.prototype.getURLObj=function(){return window.URL||window.webkitURL},e.prototype.createImage=function(e,t){var n=this,i=new Image;i.onload=function(){for(var e=0,r=n.listeners;e<r.length;e++){(0,r[e])(i,t)}},i.src=e},e.prototype.listen=function(e){this.init(),this.listeners.push(e)},e}()},"./js/PreviewPlugin.ts":function(e,t,n){"use strict";n.d(t,"a",function(){return o});var i=n("./js/PasteImage.ts"),r=3,o=function(){function e(){var e=this;this.initPromise=null,this.offsetMap=[],this.scrollMode=null,this.preview=_.throttle(function(t,n){e.initAceHooks(),e.initPreviewHooks(n),window.onpopstate=e.onHashChange,e.init().then(function(){e.renderer.renderText(t,n).then(function(){setTimeout(function(){e.buildOffsetMap(n)},500)})})},500),this.buildOffsetMap=_.throttle(function(t){var n=t.offset().top,i=[];t.find("[data-line]").each(function(){i[parseInt(this.dataset.line,10)]=$(this).offset().top-n}),e.offsetMap=i},1e3),this.onScrollEditor=_.throttle(function(t){if("preview"!==e.scrollMode){e.scrollMode="editor";var n=Math.max(0,Math.floor(t/15)-r),i=e.offsetMap.find(function(e,t){return void 0!==e&&t>=n});void 0!==i&&$("#preview").scrollTop(i),e.resetScrollMode()}},100),this.onScrollPreview=_.throttle(function(){if("editor"!==e.scrollMode){e.scrollMode="preview";var t=e.previewElement.scrollTop(),n=e.offsetMap.findIndex(function(e){return e>=t-1});n<e.session.getLength()&&aceEditor.scrollToLine(Math.max(n-r,0),!1,!0,function(){}),e.resetScrollMode()}},100),this.resetScrollMode=_.debounce(function(){e.scrollMode=null},500),this.handleImage=function(t,n){OC.dialogs.prompt("Enter the name for the image","Upload image",function(i,r){if(i){var o=t.src,s=aceEditor.getCursorPosition(),a="![uploading...]("+o+")",c="!["+r+"]("+r+")";e.session.insert(s,a),e.uploadImage(r,n).then(function(){e.session.replace(new e.rangeConstructor(s.row,s.column,s.row,s.column+a.length),c)})}},!0,"image name")}}return e.prototype.init=function(){var e=this;if(!this.initPromise){this.initPromise=n.e(0).then(n.bind(null,"./js/Renderer.ts")).then(function(t){var n=t.Renderer;e.renderer=new n},console.error.bind(console)),this.textEditorOnHashChange||(this.textEditorOnHashChange=window.onpopstate);var t=window.ace.acequire||window.ace.require;this.rangeConstructor=t("ace/range").Range,(new i.a).listen(this.handleImage)}return this.initPromise},e.prototype.initAceHooks=function(){this.session!==aceEditor.getSession()&&(this.session=aceEditor.getSession(),aceEditor.$blockScrolling=1/0,this.session.on("changeScrollTop",this.onScrollEditor))},e.prototype.initPreviewHooks=function(e){this.previewElement!==e&&(this.previewElement=e,this.previewElement.scroll(this.onScrollPreview),this.initCheckboxHandler(e))},e.prototype.onHashChange=function(e){"editor"!==window.location.hash.substr(1).substr(0,6)&&this.textEditorOnHashChange&&this.textEditorOnHashChange.call(window,e)},e.prototype.initCheckboxHandler=function(e){var t=this.rangeConstructor,n=this.session;e.on("change","input[type=checkbox]",function(){var e=this.checked,i=this.dataset.line,r=n.getLine(i),o=r.indexOf("[")+1;n.replace(new t(i,o,i,o+1),e?"x":" "),n.$wrapData.length=n.doc.getLength()})},e.prototype.uploadImage=function(e,t){var n=(this.getCurrentPath()+"/"+e).replace(/\/\/+/g,"/"),i=OC.linkToRemote("files"+n),r=new FileReader,o=$.Deferred();return r.onloadend=function(e){$.ajax({url:i,processData:!1,data:r.result,type:"PUT",success:o.resolve.bind(o),error:o.reject.bind(o)})},r.readAsArrayBuffer(t),o.promise()},e.prototype.getCurrentPath=function(){return OCA.Files_Texteditor.file&&OCA.Files_Texteditor.file.dir?OCA.Files_Texteditor.file.dir:OCA.Files.App&&OCA.Files.App.fileList._currentDirectory?OCA.Files.App.fileList._currentDirectory:void 0},e}()},"./js/PublicPreview.ts":function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i=function(){function e(){this.initPromise=null}return e.prototype.init=function(){var e=this;if(!this.initPromise){var t=$.Deferred();n.e(0).then(function(){var i=n("./js/Renderer.ts").Renderer;e.renderer=new i(!0),t.resolve()}.bind(null,n)).catch(n.oe),this.initPromise=t.promise()}return this.initPromise},e.prototype.attach=function(e,t){var n=this;e.addClass("icon-loading").children().remove(),$.when(this.getFileContent(t),this.init()).then(function(t){var i=t[0];e.removeClass("icon-loading"),n.renderer.renderText(i,e)})},e.prototype.getFileContent=function(e){var t=OC.generateUrl("/s/{token}/download",{token:e});return $.get(t)},e}()},"./js/SidebarPreview.ts":function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i=function(){function e(){var e=this;this.initPromise=null,this.handlePreview=function(t,n,i,r){var o=i.parent().width()+50,s=o/(16/9);$.when(e.getFileContent(t.getFullPath()),e.init()).then(function(t){var r=t[0];n.removeClass("icon-loading icon-32"),i.addClass("large"),i.addClass("text");var o=$('<div id="preview" class="text-markdown"/>');e.renderer.renderText(r,o),n.children(".stretcher").remove(),n.append(o),i.css("max-height",s)},function(){r()})}}return e.prototype.init=function(){var e=this;if(!this.initPromise){var t=$.Deferred();n.e(0).then(function(){var i=n("./js/Renderer.ts").Renderer;e.renderer=new i,t.resolve()}.bind(null,n)).catch(n.oe),this.initPromise=t.promise()}return this.initPromise},e.prototype.attach=function(e){e.addPreviewHandler("text/markdown",this.handlePreview)},e.prototype.getFileContent=function(e){var t=OC.linkToRemoteBase("files"+e);return $.get(t)},e}()},"./js/editor.ts":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("./js/PreviewPlugin.ts"),r=n("./js/SidebarPreview.ts"),o=n("./js/PublicPreview.ts"),s=new i.a;$(document).ready(function(){if(OCA.Files_Texteditor&&OCA.Files_Texteditor.registerPreviewPlugin?OCA.Files_Texteditor.registerPreviewPlugin("text/markdown",s):OCA.Files_Texteditor||(OCA.Files_Texteditor={}),$("#isPublic").val()&&"text/markdown"===$("#mimetype").val()){var e=new o.a,t=$("#preview");t.addClass("text-markdown");var n=$('<div class="public-preview"/>');t.prepend(n),e.attach(n,$("#sharingToken").val())}}),n.p=OC.filePath("files_markdown","js","../build/");var a=document.querySelector("[nonce]");n.nc=a.nonce||a.getAttribute("nonce"),OC.Plugins.register("OCA.Files.SidebarPreviewManager",new r.a)}});
//# sourceMappingURL=editor.js.map